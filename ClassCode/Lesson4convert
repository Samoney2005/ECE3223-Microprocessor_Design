#include "mbed.h"

BusOut display(p5, p6, p7, p8, p9, p10, p11, p12);

int segConvert(int symbol);

void displayInt(int n)
{
    if (n < 0) {
        display = segConvert('-');
        wait_us(500000);
        n = -n;
    }
    if (n < 10) {
        display = segConvert(n);
        wait_us(500000);
        display = 0;
        wait_us(1000000);
    } else {
        int q, r;
        q = n / 10;
        r = n % 10;
        displayInt(q);
        displayInt(r);
    }
}

void displayFrac(float f)
{
    display = segConvert('.');
    wait_us(500000);
    for (int digits = 1; digits <= 3; digits++) {
        int i = f * 10;
        display = segConvert(i);
        wait_us(500000);
        f = (f * 10) - i;
        if (f == 0) {
            break;
        }
    }
}

void displayFloat(float f)
{
    int i;
    float frac;
    f = f + 0.0005;
    if (f < 0) {
        display = segConvert('-');
        wait_us(500000);
        f = -f;
    }
    i = f;
    frac = f - i;
    displayInt(i);
    displayFrac(frac);
}

int main()
{
    while (true) {
        displayFloat(3.14);
    }
}

int segConvert(int symbol)
{
    switch (symbol) {
        case 0:  return 0b00111111;
        case 1:  return 0b00000110;
        case 2:  return 0b01011011;
        case 3:  return 0b01001111;
        case 4:  return 0b01100110;
        case 5:  return 0b01101101;
        case 6:  return 0b01111101;
        case 7:  return 0b00000111;
        case 8:  return 0b01111111;
        case 9:  return 0b01101111;
        case '-': return 0b01000000;
        case '.': return 0b10000000;
        default:  return 0;
    }
}

